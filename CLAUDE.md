# CLAUDE.md

> æœ¬æ–‡ä»¶ç”¨äºå­˜å‚¨ Claude Code çš„é¡¹ç›®çº§é…ç½®ä¸è¯´æ˜

---

## é¡¹ç›®æ¦‚è¿°

**DuiDuiMaoï¼ˆå…‘å…‘çŒ«ï¼‰** æ˜¯ä¸€ä¸ªåŸºäº LinuxDo Connect ç™»å½•çš„å…¬ç›Š CDK å…‘æ¢å¹³å°ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- ç”¨æˆ·é€šè¿‡ LinuxDo Connect è¿›è¡Œèº«ä»½è®¤è¯
- CDK å…‘æ¢åŠŸèƒ½
- ç®¡ç†å‘˜åå°ç®¡ç†

---

## æŠ€æœ¯æ ˆ

### åç«¯
- **è¯­è¨€**: Go
- **æ¡†æ¶**: Gin (æ¨èï¼ŒåŸºäºæ ‡å‡† HTTP è·¯ç”±)
- **æ•°æ®åº“**: PostgreSQLï¼ˆç”Ÿäº§ï¼‰/ CSV æ–‡ä»¶ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

### å‰ç«¯
- **æ¡†æ¶**: Vue 3
- **UI ç»„ä»¶**: Shadcn-vue
- **æ„å»ºå·¥å…·**: Vite
- **æ ·å¼**: Tailwind CSS

### éƒ¨ç½²
- **å®¹å™¨åŒ–**: Docker
- **ç¼–æ’**: Docker Compose
- **CI/CD**: GitHub Actions

---

## é¡¹ç›®æ¶æ„

```
DuiDuiMao/
â”œâ”€â”€ Docs/                          # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ API/                       # API æ–‡æ¡£
â”‚   â”‚   â””â”€â”€ LinuxDo-OAuth APIæ–‡æ¡£.md
â”‚   â””â”€â”€ éœ€æ±‚æ–‡æ¡£.md
â”‚
â”œâ”€â”€ cmd/                           # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go                # åç«¯æœåŠ¡å…¥å£
â”‚
â”œâ”€â”€ Temp/                          # æµ‹è¯•ç¼“å­˜ï¼ˆå¼€å‘æ¨¡å¼ CSV å­˜å‚¨ï¼‰
â”‚
â”œâ”€â”€ internal/                      # å†…éƒ¨åŒ…ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ handler/                   # HTTP å¤„ç†å™¨ï¼ˆè·¯ç”±å±‚ï¼‰
â”‚   â”œâ”€â”€ service/                   # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â””â”€â”€ model/                     # æ•°æ®æ¨¡å‹å±‚
â”‚
â”œâ”€â”€ web/                           # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/            # Vue ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ views/                 # é¡µé¢è§†å›¾
â”‚   â”‚   â”œâ”€â”€ assets/                # é™æ€èµ„æº
â”‚   â”‚   â””â”€â”€ main.js                # å‰ç«¯å…¥å£
â”‚   â”œâ”€â”€ dist/                      # å‰ç«¯æ„å»ºäº§ç‰©ï¼ˆæœ¬åœ°ä¸ä¸Šä¼ ï¼‰
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â””â”€â”€ tailwind.config.js
â”‚
â”œâ”€â”€ config.example.yaml            # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”œâ”€â”€ Dockerfile                     # Docker é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ docker-compose.yml             # ç”Ÿäº§ç¯å¢ƒç¼–æ’ï¼ˆäº‘ç«¯é•œåƒï¼‰
â”œâ”€â”€ docker-compose.dev.yml         # å¼€å‘ç¯å¢ƒç¼–æ’ï¼ˆæœ¬åœ°æ„å»ºï¼‰
â””â”€â”€ go.mod                         # Go ä¾èµ–ç®¡ç†
```

---

## ç¯å¢ƒå˜é‡é…ç½®

### Docker éƒ¨ç½²ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `adminname` | ç®¡ç†å‘˜è´¦æˆ·å | `root` |
| `adminpassword` | ç®¡ç†å‘˜å¯†ç  | `rootpassword` |
| `port` | æœåŠ¡ç›‘å¬ç«¯å£ | `3001` |
| `mode` | è¿è¡Œæ¨¡å¼ | `server` |
| `dburl` | PostgreSQL æ•°æ®åº“è¿æ¥ | - |

### è¿è¡Œæ¨¡å¼è¯´æ˜

#### server æ¨¡å¼ï¼ˆç”Ÿäº§ï¼‰
- å¼ºåˆ¶è¦æ±‚é…ç½® PostgreSQL æ•°æ®åº“
- æ‰€æœ‰æ•°æ®æŒä¹…åŒ–å­˜å‚¨

#### dev æ¨¡å¼ï¼ˆå¼€å‘æµ‹è¯•ï¼‰
- ä½¿ç”¨ CSV æ–‡ä»¶å­˜å‚¨æ•°æ®ï¼ˆä¿å­˜åœ¨ `Temp/` ç›®å½•ï¼‰
- æ— éœ€é…ç½®æ•°æ®åº“ï¼Œå¿«é€Ÿå¯åŠ¨æµ‹è¯•

### é…ç½®æ–‡ä»¶
- å¤åˆ¶ `config.example.yaml` ä¸º `config.yaml` åä¿®æ”¹é…ç½®
- `config.yaml` å·²è¢« `.gitignore` å±è”½ï¼Œä¸ä¼šæäº¤åˆ°ä»“åº“

---

## å¼€å‘è§„èŒƒ

### ğŸ” å®‰å…¨è§„èŒƒï¼ˆæ ¸å¿ƒè¦æ±‚ï¼‰

#### æ¥å£åŠ å¯†
- **æ‰€æœ‰å¯¹å¤–æš´éœ²çš„æ¥å£å¿…é¡»åŠ å¯†**ï¼ˆç™»å½•æ¥å£é™¤å¤–ï¼‰
- ä½¿ç”¨ HTTPS ä¼ è¾“
- æ•æ„Ÿæ•°æ®ä¼ è¾“éœ€åŠ å¯†å¤„ç†

#### å†…éƒ¨æ•°æ®ä¼ é€’
- **ç³»ç»Ÿå†…æ•°æ®ä¼ é€’ä½¿ç”¨ä¸¤æ¬¡ Base64 åŠ å¯†**
- åŠ å¯†æµç¨‹ï¼š`åŸå§‹æ•°æ®` â†’ `Base64ç¼–ç ` â†’ `Base64ç¼–ç ` â†’ `æœ€ç»ˆæ•°æ®`
- è§£å¯†æµç¨‹ï¼š`æœ€ç»ˆæ•°æ®` â†’ `Base64è§£ç ` â†’ `Base64è§£ç ` â†’ `åŸå§‹æ•°æ®`

#### Go å®ç°ç¤ºä¾‹
```go
// åŒé‡ Base64 åŠ å¯†
func DoubleEncode(data string) string {
    return base64.StdEncoding.EncodeToString(
        []byte(base64.StdEncoding.EncodeToString([]byte(data))),
    )
}

// åŒé‡ Base64 è§£å¯†
func DoubleDecode(encoded string) (string, error) {
    first, err := base64.StdEncoding.DecodeString(encoded)
    if err != nil {
        return "", err
    }
    second, err := base64.StdEncoding.DecodeString(string(first))
    if err != nil {
        return "", err
    }
    return string(second), nil
}
```

#### Vue å®ç°ç¤ºä¾‹
```javascript
// åŒé‡ Base64 åŠ å¯†
function doubleEncode(data) {
  return btoa(btoa(unescape(encodeURIComponent(data))))
}

// åŒé‡ Base64 è§£å¯†
function doubleDecode(encoded) {
  return decodeURIComponent(escape(atob(atob(encoded))))
}
```

---

### Go åç«¯è§„èŒƒ
- éµå¾ª [Effective Go](https://go.dev/doc/effective_go) ç¼–ç é£æ ¼
- ä½¿ç”¨ `gofmt` æ ¼å¼åŒ–ä»£ç 
- é”™è¯¯å¤„ç†ä¸ä½¿ç”¨ `panic`ï¼Œè¿”å› error ç±»å‹
- åŒ…åä½¿ç”¨å°å†™å•è¯ï¼Œä¸ä½¿ç”¨ä¸‹åˆ’çº¿æˆ–é©¼å³°

### Vue å‰ç«¯è§„èŒƒ
- ç»„ä»¶å‘½åä½¿ç”¨ PascalCaseï¼ˆå¦‚ `UserProfile.vue`ï¼‰
- ç»„åˆå¼ APIï¼ˆComposition APIï¼‰ä¼˜äºé€‰é¡¹å¼ API
- ä½¿ç”¨ `<script setup>` è¯­æ³•ç³–
- æ ·å¼ä¼˜å…ˆä½¿ç”¨ Tailwind CSS å·¥å…·ç±»

### Git æäº¤è§„èŒƒ
- feat: æ–°åŠŸèƒ½
- fix: ä¿®å¤ Bug
- docs: æ–‡æ¡£æ›´æ–°
- style: ä»£ç æ ¼å¼è°ƒæ•´
- refactor: é‡æ„ï¼ˆä¸æ”¹å˜åŠŸèƒ½ï¼‰
- test: æµ‹è¯•ç›¸å…³
- chore: æ„å»º/å·¥å…·é“¾ç›¸å…³

---

## æ–‡æ¡£ç´¢å¼•

### éœ€æ±‚æ–‡æ¡£
ğŸ“„ **å®Œæ•´åŠŸèƒ½éœ€æ±‚**: `Docs/éœ€æ±‚æ–‡æ¡£.md`
- ç¬¬ 68-117 è¡Œï¼šæ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆusersã€cdk_categoriesã€cdksã€redeem_logsï¼‰
- ç¬¬ 120-150 è¡Œï¼šæ¥å£è§„åˆ’ï¼ˆç”¨æˆ·ç«¯ 7 ä¸ª + ç®¡ç†ç«¯ 10 ä¸ªï¼‰
- ç¬¬ 154-161 è¡Œï¼šå®‰å…¨è¦ç‚¹

### API æ–‡æ¡£
ğŸ“„ **LinuxDo OAuth2 æ¥å…¥**: `Docs/API/LinuxDo-OAuth APIæ–‡æ¡£.md`
- æˆæƒç«¯ç‚¹ã€Token ç«¯ç‚¹ã€ç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹
- ä¿¡ä»»ç­‰çº§è¯´æ˜ï¼ˆ0-4 çº§ï¼‰
- æˆæƒæµç¨‹è¯¦è§£

---

## éƒ¨ç½²æµç¨‹

### GitHub Actions
1. è‡ªåŠ¨æ„å»ºå‰ç«¯äº§ç‰©ï¼ˆ`web/dist/`ï¼‰
2. æ„å»ºåç«¯äºŒè¿›åˆ¶æ–‡ä»¶
3. æ‰“åŒ…æˆ Docker é•œåƒå¹¶æ¨é€

### Docker éƒ¨ç½²
```bash
# ç”Ÿäº§ç¯å¢ƒï¼ˆä½¿ç”¨äº‘ç«¯æ„å»ºçš„é•œåƒï¼‰
docker-compose -f docker-compose.yml up -d

# å¼€å‘ç¯å¢ƒï¼ˆæœ¬åœ°æ„å»ºé•œåƒï¼‰
docker-compose -f docker-compose.dev.yml up -d
```

---

## æ³¨æ„äº‹é¡¹

1. **å‰ç«¯æ„å»º**: æœ¬åœ°å¼€å‘æ—¶ä¸éœ€è¦æ‰‹åŠ¨æ„å»ºå‰ç«¯ï¼ŒGitHub Actions ä¼šè‡ªåŠ¨æ„å»º
2. **é…ç½®å®‰å…¨**: `config.yaml` åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå·²è¢« `.gitignore` å±è”½
3. **Docker ç¼–æ’**: æä¾›ä¸¤ä¸ª yml æ–‡ä»¶ï¼Œåˆ†åˆ«ç”¨äºç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒ
4. **å…‘æ¢äº‹åŠ¡**: CDK çŠ¶æ€æ›´æ–°å’Œè®°å½•å†™å…¥å¿…é¡»æ˜¯åŸå­æ“ä½œ
5. **é™é¢æ ¡éªŒ**: å¿…é¡»åœ¨åç«¯è¿›è¡Œï¼Œä¸èƒ½åªé å‰ç«¯
6. **ç®¡ç†æ¥å£é‰´æƒ**: æ‰€æœ‰ `/api/admin/*` æ¥å£å¿…é¡»æ ¡éªŒç®¡ç†å‘˜èº«ä»½
